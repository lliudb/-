

### 2.1 `status`状态定义
字段类型：字段类型设置为`TINYINT`
字段长度：2, 0-99

### 2.1.1 规则描述方式
* 1.描述请遵循：`状态编号`+`默认的状态单词`+`语义`+`排除易混淆的状态`。
* 2.请确保你的描述中**不会存在**与**已有的描述**存在冲突**（即`同义`或`包含`或`交叉`）**。
* 3.请确保描述为`同质`或`同义`的`形容词`。

### 2.1.2 规则描述参考
一下内容仅供参考:

* **`0`**始终默认为**OFF**，认为是**`未发布的`**，**`无效的`**，**`关闭的`**，**`下线的`**，**`被忽略的`**，但**不等于`被删除的`**或其他任何状态。
* **`1`**始终默认为**ON**，认为是**`有效的`**，**`通过的`**，**`上线的`**，**`开启的`**，但是不等于其他任何状态。
* **`2`**始终默认为**DEL**，认为是**`被隐藏的`**，**`不可见的`**，**`被删除的`**，但是不等于其他任何状态。
* **`3`**始终默认为**IDLE**，认为是**`待处理的`**，**`待审核的`**，但不等于其他任何状态。
* **`4`**始终默认为**DENY**，认为是**`被废弃的`**，**`被拒绝的`**，**`不通过的`**，**`被禁止的`**，但不等于其他任何状态。
* **`5`**始终默认为**LIMIT**，认为是**`被限制的`**，**`有条件的`**，**`需要权限的`**，但不等于其他任何状态。
* **`>= 6`**为**自定义**的扩展状态,根据业务需求自定义添加相关状态设置，**规则请遵循 `2.1.2` 规则的描述**

-------
为方便使用，增加聚合状态（即数组形态的状态）

* **[1,3]** 为 `显示数据集合`：即用户能够通过正常方式的访问的数据
* **[4,5]** 为 `访问受限集合`：即用户需要通过特殊条件才能访问的数据
* **[0,1]** 为 `隐式数据集合`：即用户不能通过正常方式的访问的数据

### 2.1.3 【表-状态-语义】说明表
规则实际使用时对应表中的含义:

|        状态        | **OFF** | **ON** | **DEL** | **IDLE** | **DENY** | **LIMIT** |
|:----------------:|:-------:|:------:|:-------:|:--------:|:--------:|:---------:|
| (sns_)`表名`/`状态值` |  **0**  | **1**  |  **2**  |  **3**   |  **4**   |   **5**   |
|     `groups`     |  `关闭的`  | `开启的`  | `被删除的`  |    -     |    -     |  `被限制的`   |
|     `panels`     | `未发布的`  | `有效的`  | `被删除的`  |  `待处理的`  |  `被禁止的`  |  `被限制的`   |
|      `tags`      | `未发布的`  | `有效的`  | `被删除的`  |    -     |  `被废弃的`  |     -     |
|  `discussions`   |    -    | `有效的`  | `被删除的`  |  `待处理的`  |    -     |     -     |
|    `reports`     | `未采纳的`  | `未处理`  | `已删除`  |  `待处理`  |  `不通过的`  |`采纳的`|
|    `notices`     |    -    | `有效的`  | `被删除的`  |    -     |    -     |     -     |
|   `resources`    |    -    | `有效的`  | `被删除的`  |    -     |    -     |  `被限制的`   |
|   `tamplates`    |    -    | `有效的`  | `被删除的`  |    -     |  `被废弃的`  |     -     |
|  `user_object`   |    -    | `有效的`  | `被删除的`  |    -     |    -     |     -     |
|  `user_to_user`  |  `关闭的`  | `开启的`  | `被删除的`  |    -     |    -     |     -     |


### 2.1.4 【状态】 状态机设置

```php
    {
        groups : {
            default:1,  //默认状态
            all:{  //该表包含的所有状态
                0:"已关闭",1:"已开启",2:"已删除",5:"已受限"
            },
            deny:{    //禁止的状态跳转
                1:[2],  //该设置表明，1不能跳转到2状态
            },
            allow:{//允许的状态跳转,如设置，则只允许已设定的跳转,如无特定设置，则默认除禁止状态的跳转以外的操作皆允许
                1:[0,5]     //该设置表明，1只能跳转到 0和5 状态
            }
        }
    }
************************
对应上表中配置PHP中的统一处理方法
************************
  /**
   * 状态跳转统一控制方法,该方法只适用于 sns_ 表的状态控制
   * @param  [type] $accept    期望状态
   * @param  [type] $tableName 更改的表名
   * @param  array  $where     筛选条件
   * @param  string $field     状态的在表中对应的实际字段
   * @return [err=>"",code=>0] 错误时code=0，err为错误描述信息
   *                           正确时返回影响行数，code理论上为1，不为1时请检查
   */
  public function statusJumpControllor($accept,$tableName,$where = [],$updateTime = true,$field = 'status')
  {
    if (empty($accept) || empty($tableName) || empty($where)) {
      return ['err'=>"期望的状态值或表名或过滤条件不能为空",'code'=>420];
    }else{
      $config = C("STATUS_FSM");
      $settings = $config[$tableName];
      if (empty($settings)) {
        return ['err'=>"没有相关的配置",'code'=>421];
      }else if(!empty($settings['all'][$accept])){
        $find = $this->table($tableName)->where($where)->find();
        if (empty($find)) {
          return ['err'=>"错误的筛选条件",'code'=>422];
        }elseif ($find[$field] == $accept) {//已经为该状态
          return ['err'=>"已经操作过了",'code'=>422];
        }
        $status = $find[$field];
        //先判断是否是被禁止的转态跳转
        if ((!empty($settings['deny'][$status])) && in_array($accept, $settings['deny'][$status])) {
          return ['err'=>"被禁止的状态跳转",'code'=>423];
        }
        //检查是否设置只允许的跳转路径
        if ((!empty($settings['allow'][$status])) && !in_array($accept,$settings['allow'][$status])) {
          return ['err'=>"不在可跳转的状态行列",'code'=>424];
        }
        //通过检查后则进行状态设置
        $save[$field] = $accept;
        if ($updateTime) {
          $save['updated_at'] = date('Y-m-d H:i:s');
        }
        $effect = $this->table($tableName)->where($where)->save($save);
        if ($effect) {
          return ['err'=>"",'code'=>0];
        }else{
          return ['err'=>"状态更新失败",'code'=>456];
        }
      }else{
        return ['err'=>"错误的期望状态",'code'=>425];
      }
    }
  }
```
